@model QL_BANDIENTHOAI.Models.SanPham
@{
    Layout = null;
}
@Html.Partial("_HeaderCustom")

<!-- BẮT BUỘC THÊM JQUERY -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="stylesheet" href="~/Content/CSS/detail.css" />

<div class="detail-container">
    <div class="detail-left">
        <img src="@Url.Content("~/Content" + Model.AnhSanPham)" class="detail-img" />
    </div>
    <div class="detail-right">
        <h2>@Model.TenSp</h2>
        <div class="detail-price">@String.Format("{0:N0} đ", Model.GiaBan)</div>
        <div class="detail-rating">⭐ @ViewBag.AvgStar.ToString("0.0") <span>(@ViewBag.ReviewCount lượt)</span></div>
        <p class="detail-desc">@Model.MoTa</p>

        <table class="spec-table">
            <tr><td>RAM</td><td>@Model.Ram</td></tr>
            <tr><td>Bộ nhớ</td><td>@Model.Rom</td></tr>
            <tr><td>Hệ điều hành</td><td>@Model.Os</td></tr>
            <tr><td>Chipset</td><td>@Model.Chipset</td></tr>
            <tr><td>GPU</td><td>@Model.Gpu</td></tr>
            <tr><td>Camera</td><td>@Model.Camera</td></tr>
            <tr><td>Dung lượng pin</td><td>@Model.Pin</td></tr>
            <tr><td>Màn hình</td><td>@Model.ManHinh</td></tr>
            <tr><td>Kích thước</td><td>@Model.KichThuoc</td></tr>
            <tr><td>Trọng lượng</td><td>@Model.TrongLuong</td></tr>
            <tr><td>SIM</td><td>@Model.SimCard</td></tr>
        </table>

        <a id="btnAddCart" data-masp="@Model.MaSp" href="#" class="detail-btn add-cart-btn">
            Thêm vào giỏ hàng
        </a>
    </div>
</div>

<h3 class="related-title">Sản phẩm liên quan</h3>
<div class="related-list">
    @foreach (var item in ViewBag.Related)
    {
        <div class="related-card" onclick="location.href='/Detail?masp=@item.MaSp'">
            <img src="@Url.Content("~/Content" + item.AnhSanPham)" />
            <p class="name">@item.TenSp</p>
            <p class="price">@String.Format("{0:N0} đ", item.GiaBan)</p>
        </div>
    }
</div>

@Html.Partial("_FooterCustom")

<!-- SCRIPT AJAX ĐÃ HOÀN CHỈNH -->
<script>
    $(document).ready(function () {
        $("#btnAddCart").click(function (e) {
            e.preventDefault();
            var masp = $(this).data("masp");

            $.ajax({
                url: "/Cart/AddAjax",
                type: "POST",
                data: { masp: masp },
                success: function (res) {
                    if (!res.success) {
                        alert("Vui lòng đăng nhập!");
                        window.location.href = "/Account/Login";
                        return;
                    }
                    // Cập nhật số lượng + hiện toast
                    $("#cartCount").text(res.cart);
                    var toast = $('<div class="toast-add">Đã thêm vào giỏ hàng!</div>');
                    $("body").append(toast);
                    toast.fadeIn(300);
                    setTimeout(() => toast.fadeOut(500, () => toast.remove()), 2000);
                },
                error: function () {
                    alert("Lỗi hệ thống!");
                }
            });
        });
    });
</script>

<style>
    .toast-add {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #28a745;
        color: #fff;
        padding: 16px 24px;
        border-radius: 8px;
        font-size: 16px;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
</style>